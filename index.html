<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="My way of learning">
<meta property="og:url" content="https://flyliufu.github.io/index.html">
<meta property="og:site_name" content="My way of learning">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="My way of learning">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 'undefined',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://flyliufu.github.io/"/>





  <title> My way of learning </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">My way of learning</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://flyliufu.github.io/2018/02/07/二叉树/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fu Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/9735870?v=3&u=33ed681a589c432a123bbdc242b25d56a1a0ac7b&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My way of learning">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/02/07/二叉树/" itemprop="url">
                  二叉树
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-02-07T13:50:42+08:00">
                2018-02-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/翻译/" itemprop="url" rel="index">
                    <span itemprop="name">翻译</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/02/07/二叉树/" class="leancloud_visitors" data-flag-title="二叉树">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="二叉查找树-Binary-Search-Tree"><a href="#二叉查找树-Binary-Search-Tree" class="headerlink" title="二叉查找树 Binary Search Tree"></a>二叉查找树 Binary Search Tree</h1><p>转载请注明<a href="http://pages.cs.wisc.edu/~vernon/cs367/notes/9.BST.html" target="_blank" rel="external">文章出处</a>，如有侵权请联系 flyliufu@gmail.com 立删。</p>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>二叉查找树（binary search tree , BST）是一种特殊且重要的二叉树，在<code>BST</code> 中每个节点存储一些信息包括一个唯一的键值对（Key Value），并且还有可能有一些相关联的数据。一个二叉树当且仅当（iff）是二叉查找树时候，它的每个节点n在二叉树中应满足：</p>
<pre><code>1. 所有n 的左子树中的 key 值都应该小于 n 的 key 值，并且
2. 所有 n 的右子树中的 key 值都应大于 n 的 key 值。
</code></pre><p>注意：如果允许相同的 key 值出现，那么该节点即可以在 n 的左子树，也可以在 n 的右子树（但不能同时在两边），在这个前提下，下面我们的教程假设不允许重复值出现。</p>
<p>​    </p>
<p>​    下面是一些每个节点仅仅存储了一个整型数值的 BST </p>
<p><img src="../../../../images/二叉树/bst1.jpg" alt="BST"></p>
<p>​    </p>
<p>​    下面这些不是 BST</p>
<p><img src="../../../../images/二叉树/bst2.jpg" alt="非 BST"></p>
<p>左边这个5比6小（应该在左子树4的右子节点），右边这个6比7小（应该在5 的右子节点）。</p>
<p>注意不止一种 BST 可以存储相同的键值对，举个栗子下面这张图中的两个 BST 都是存储了相同的整型键：</p>
<p><img src="../../../../images/二叉树/sameBSTs.jpg" alt="非 BST">    </p>
<p>二叉搜索树很重要的原因是使用BST可以有效地执行以下操作：</p>
<pre><code>1. 添加键值对
2. 决定一个键值对在树中的位置
3. 从树中删除键值对
4. 打印排序后的所有键值对
</code></pre><hr>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><ol>
<li>以下那些二叉树是BST？哪些不是？为什么？</li>
<li>用什么排序（preorder 先根排序, postorder 后根排序, inorder 中根排序, or level-order） 可以以顺序输出节点值？</li>
</ol>
<p><img src="../../../../images/二叉树/question1.png" alt="非 BST"></p>
<hr>
<h2 id="实现二叉搜索树"><a href="#实现二叉搜索树" class="headerlink" title="实现二叉搜索树"></a>实现二叉搜索树</h2><p>为了实现一个二叉搜索树（BST）我们将要使用两个类：一个是树节点（tree node）、一个是二叉搜索树本身，下面定义的类是假设节点只存储键值，没有关联数据。因为大多数的 BST 操作都是比较 key 值，我们把 key 的类型设置为<code>Comparable</code> (不是 <code>Object</code>)。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BinaryTreenode</span> </span>&#123;</div><div class="line">   <span class="comment">// *** fields ***</span></div><div class="line">   <span class="keyword">private</span> Comparable key;</div><div class="line">   <span class="keyword">private</span> BinaryTreenode left, right;</div><div class="line"></div><div class="line">   <span class="comment">// *** methods ***</span></div><div class="line"></div><div class="line">   <span class="comment">// constructor</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="title">BinaryTreenode</span><span class="params">(Comparable k, BinaryTreenode l, BinaryTreenode r)</span> </span>&#123;</div><div class="line">       key = k;</div><div class="line">       left = l;</div><div class="line">       right = r;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="comment">// access to fields</span></div><div class="line">   <span class="function"><span class="keyword">public</span> Comparable <span class="title">getKey</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> key;&#125;</div><div class="line">   <span class="function"><span class="keyword">public</span> BinaryTreenode <span class="title">getLeft</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> left;&#125;</div><div class="line">   <span class="function"><span class="keyword">public</span> BinaryTreenode <span class="title">getRight</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> right;&#125;</div><div class="line"></div><div class="line">   <span class="comment">// change fields</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setKey</span><span class="params">(Comparable k)</span> </span>&#123;key = k;&#125;</div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLeft</span><span class="params">(BinaryTreenode l)</span> </span>&#123;left = l;&#125;</div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRight</span><span class="params">(BinaryTreenode r)</span> </span>&#123;right = r;&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BST</span> </span>&#123;</div><div class="line">  <span class="comment">// *** fields ***</span></div><div class="line">  <span class="keyword">private</span> BinaryTreenode root; <span class="comment">// ptr to the root of the BST</span></div><div class="line"></div><div class="line">  <span class="comment">// *** methods ***</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">BST</span><span class="params">()</span> </span>&#123; root = <span class="keyword">null</span>; &#125; <span class="comment">// constructor</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(Comparable key)</span> <span class="keyword">throws</span> DuplicateException </span>&#123;...&#125;</div><div class="line">      <span class="comment">// add key to this BST; error if it is already there</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Comparable key)</span> </span>&#123;...&#125;</div><div class="line">      <span class="comment">// remove the node containing key from this BST if it is there;</span></div><div class="line">      <span class="comment">// otherwise, do nothing</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lookup</span><span class="params">(Comparable key)</span> </span>&#123;...&#125;</div><div class="line">     <span class="comment">// if key is in this BST, return true; otherwise, return false</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(PrintWriter p)</span> </span>&#123;...&#125;</div><div class="line">     <span class="comment">// print the values in this BST in sorted order (to p)</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>为了实现 BST 对应每个 key 存储数据我们需要使用下列定义类：(和上面有些不一样，我不会标红)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BinaryTreenode</span> </span>&#123;</div><div class="line">   <span class="comment">// *** fields ***</span></div><div class="line">   <span class="keyword">private</span> Comparable key;</div><div class="line">   <span class="keyword">private</span> Object data;</div><div class="line">   <span class="keyword">private</span> BinaryTreenode left, right;</div><div class="line"></div><div class="line">   <span class="comment">// *** methods ***</span></div><div class="line"></div><div class="line">   <span class="comment">// constructor</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="title">BinaryTreenode</span><span class="params">(Comparable k, Object d, BinaryTreenode l, BinaryTreenode r)</span> </span>&#123;</div><div class="line">       key = k;</div><div class="line">       data = d;</div><div class="line">       left = l;</div><div class="line">       right = r;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   ...</div><div class="line">   <span class="function"><span class="keyword">public</span> Object <span class="title">getData</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> data;&#125;</div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(Object ob)</span> </span>&#123; data = ob; &#125;</div><div class="line">   ...</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BST</span> </span>&#123;</div><div class="line">  <span class="comment">// *** fields ***</span></div><div class="line">  <span class="keyword">private</span> BinaryTreenode root; <span class="comment">// ptr to the root of the BST</span></div><div class="line"></div><div class="line">  <span class="comment">// *** methods ***</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">BST</span><span class="params">()</span> </span>&#123; root = <span class="keyword">null</span>; &#125; <span class="comment">// constructor</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(Comparable key, Object data)</span> <span class="keyword">throws</span> DuplicateException </span>&#123;...&#125;</div><div class="line">      <span class="comment">// add key and associated data to this BST;</span></div><div class="line">      <span class="comment">// error if key is already there</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Comparable key)</span> </span>&#123;...&#125;</div><div class="line">      <span class="comment">// remove the node containing key from this BST if it is there;</span></div><div class="line">      <span class="comment">// otherwise, do nothing</span></div><div class="line">  <span class="function"><span class="keyword">public</span> Object <span class="title">lookup</span><span class="params">(Comparable key)</span> </span>&#123;...&#125;</div><div class="line">     <span class="comment">// if key is in this BST, return its associated data; otherwise, return null</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(PrintWriter p)</span> </span>&#123;...&#125;</div><div class="line">     <span class="comment">// print the values in this BST in sorted order (to p)</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>从现在开始，我们将假设BST 只存储 key 值。没有关联数据，我们还假设 <code>null</code> 是一个无效的 key 值(也就是说，如果一些人尝试添加或查询一个 <code>null</code> 值会导致异常)。</p>
<h2 id="查询函数"><a href="#查询函数" class="headerlink" title="查询函数"></a>查询函数</h2><p>一般情况下，决定给定的值放在BST 中的什么位置，通常我们会从树的根节点开始然后决定从那里查找：</p>
<ol>
<li>是不是根节点</li>
<li>也许是要的左子树</li>
<li>也许是根的右子树</li>
</ol>
<p>还有两种基本情况：</p>
<ol>
<li>树是空的 ，返回false</li>
<li>给定的值是根节点，返回 true</li>
</ol>
<p>如果基本情况中不包含，在适当的子树上会循环查找，如果所有的值都小于根(root) 的值就会查找左子树反之就会查找右子树。不可能同时查找两个子树,如果我们查找的值小于根的值，那它只可能在根的左子树，大于也只可能在右子树</p>
<p><code>lookup</code> 的代码用了一个辅助的递归方法和其同名（也就是说重载了 <code>lookup</code>）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lookup</span><span class="params">(Comparable k)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> lookup(root, k);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">lookup</span><span class="params">(BinaryTreenode T, Comparable k)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (T == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    <span class="keyword">if</span> (T.getKey().equals(k)) <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    <span class="keyword">if</span> (k.compareTo(T.getKey()) &lt; <span class="number">0</span>) &#123;</div><div class="line">       	 <span class="comment">// k &lt; this node's key; look in left subtree</span></div><div class="line">		<span class="keyword">return</span> lookup(T.getLeft(), k);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">         <span class="comment">// k &gt; this node's key; look in right subtree</span></div><div class="line">		<span class="keyword">return</span> lookup(T.getRight(), k);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>让我们用下面这个 BST 来阐明一下工作原理：</p>
<p><img src="../../../../images/二叉树/lookupBST.jpg" alt=""></p>
<p>​        </p>
<p>我们查找<code>12</code></p>
<p><img src="../../../../images/二叉树/lookup12.jpg" alt=""></p>
<p>​    </p>
<ol>
<li>12小于13所以来到左子树</li>
<li>12大于9 所以到右子树</li>
<li>找到了！</li>
</ol>
<p>我们查找<code>15</code> 会发生什么    </p>
<p><img src="../../../../images/二叉树/lookup15.jpg" alt=""></p>
<p>​    </p>
<ol>
<li>15大于13查找右子树</li>
<li>15小于16查找左子树</li>
<li>左子树不存在返回 false</li>
</ol>
<p>BST 中查找一个值需要消耗多少时间呢？注意一次查找总是从根节点向下到叶节点，在最坏的情况下走过每一个节点最终到叶节点，因此，最坏情况的时间是从根到叶节点最长路径的长度的比例（树的高度）</p>
<p>通常情况下，我们想知道函数查找存储在树中的值的数量需要多少时间，换句话来说，BST 中节点数量和树高度的关系是什么？这要依赖树的”图形（shape）”。在最坏的情况下所有的节点只有一个子节点，这个树本质上来说就是一个链表结构。举个栗子：</p>
<p><img src="../../../../images/二叉树/worst-case.png" alt=""></p>
<p>这棵树有5个节点，并且高度也是5，当搜索数值在16 到 19 或 21 到 19 的时候需要从根节点到叶节点全走一遍，（也包括值为20 的节点）需要与树中节点数量成比的时间。</p>
<p>在最好的情况下所有节点都有两个子节点且所有叶节点在相同的深度。栗子：</p>
<p><img src="../../../../images/二叉树/fulltree.jpg" alt=""></p>
<p>这棵树有7个节点且高度是3，通常一棵树像这样（完全二叉树）高度大约是 log<sub>2</sub>(N)， N 是树节点的个数，公式的值粗略的是用 N 除以 2得到 0 的次数。栗子：</p>
<p>7/2 = 3      // 除 2 一次<br>3/2 = 1      // 除 2 二次<br>1/2 = 0      // 除 2 三次, 结果为 0 退出</p>
<p>所以 log<sub>2</sub>(7) 值近似等于3。</p>
<p>使用 log<sub>2</sub>的原因（而不是 log<sub>3</sub>）是因为在一个 BST 中每个非叶节点都有两个子节点，根的每个子树在整树中的的数量占1/2（大约是），所以从根到叶节点的长度会和我们用 N 除以2 的次数一样。</p>
<p>然而，当我们使用大 O 记号法来表示时候，我们仅认为 N个节点满二叉树的高度是 O(log N) — 我们舍弃了底数 “2”，因为 log<sub>2</sub>(N) 可以和任意一个常量 k 为底的对数log<sub>k</sub>(N) 成比 ，也就是说 任意常量 B，k 和任意值 N 都有：</p>
<p>log<sub>B</sub>(N) = log<sub>k</sub>(N) / log<sub>k</sub>(B)</p>
<p>并且在大 O 记号法中我们通常会省略常数因子。</p>
<p>总结：在 BST 中查询最坏情况所需时间是 O(树的高度)。在最坏的情况下（一个“链表”树）是 O(N)，N 是树中节点个数，最好的情况下（一个“满”树）是 O(log N)。</p>
<p>##添加函数</p>
<p>一个新的节点应该在 BST 的那里？答案很简单：就是你需要用<code>lookup</code> 在哪里找到它！如果你不放在那里那么以后你也不可能找的到。</p>
<p><code>insert</code> 函数代码在下面，需要注意的是：</p>
<ol>
<li>我们假设不允许添加重复的值（如果试图添加一个重复的值会导致异常）。</li>
<li>BST 类的 <code>insert</code> 方法在树为空的时候只添加key，另外它用了一个辅助的递归方法执行添加操作。</li>
<li>包含新值的节点总是作为叶节点添加在 BST 中。</li>
</ol>
<p>（talk is cheap, show me the code）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(Comparable k)</span> <span class="keyword">throws</span> DuplicateException </span>&#123;</div><div class="line">    <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</div><div class="line">        root = <span class="keyword">new</span> BinaryTreenode(k, <span class="keyword">null</span>, <span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> insert(root, k);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(BinaryTreenode T, Comparable k)</span> <span class="keyword">throws</span> DuplicateException </span>&#123;</div><div class="line"><span class="comment">// precondition: T != null</span></div><div class="line">    <span class="keyword">if</span> (T.getKey().equals(k)) <span class="keyword">throw</span> <span class="keyword">new</span> DuplicateException();</div><div class="line">    <span class="keyword">if</span> (k.compareTo(T.getKey()) &lt; <span class="number">0</span>) &#123;</div><div class="line">        <span class="comment">// add k as left child of T if it doesn't already have one</span></div><div class="line">        <span class="comment">// else insert into T's left subtree</span></div><div class="line">        <span class="keyword">if</span> (T.getLeft() == <span class="keyword">null</span>) T.setLeft( <span class="keyword">new</span> BinaryTreenode(k, <span class="keyword">null</span>, <span class="keyword">null</span>) );</div><div class="line">        <span class="keyword">else</span> insert(T.getLeft(), k);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// here when k &gt; T's key</span></div><div class="line">        <span class="comment">// insert k as right child of T if it doesn't already have one</span></div><div class="line">        <span class="comment">// else insert into T's right subtree</span></div><div class="line">        <span class="keyword">if</span> (T.getRight() == <span class="keyword">null</span>) T.setRight( <span class="keyword">new</span> BinaryTreenode(k, <span class="keyword">null</span>, <span class="keyword">null</span>) );</div><div class="line">        <span class="keyword">else</span> insert(T.getRight(), k);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>来张图来阐明一下当我们用上面代码向例子中的 BST 添加一个 <code>15</code>  的时候发生了些什么</p>
<p><img src="../../../../images/二叉树/insert15.jpg" alt=""></p>
<ol>
<li>15大于13 所以去右子树</li>
<li>15小于16去左子树</li>
<li>所以添加到16 的左子树中作为一个节点</li>
</ol>
<p>很容易看出来添加函数的复杂度和查询的的一样，在最坏的情况下一个路径要经过所有的节点到达叶节点</p>
<h3 id="小测验"><a href="#小测验" class="headerlink" title="小测验"></a>小测验</h3><p>As mentioned above, the order in which values are inserted determines what BST is built (inserting the same values in different orders can result in different final BSTs). Draw the BST that results from inserting the values 1 to 7 in each of the following orders (reading from left to right):</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://flyliufu.github.io/2017/06/03/表单验证的思路/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fu Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/9735870?v=3&u=33ed681a589c432a123bbdc242b25d56a1a0ac7b&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My way of learning">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/03/表单验证的思路/" itemprop="url">
                  表单验证的思路
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-03T09:49:01+08:00">
                2017-06-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/06/03/表单验证的思路/" class="leancloud_visitors" data-flag-title="表单验证的思路">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>​    项目中经常会遇到一些表单验证问题，最烦人的是需要在所有 <code>EditText</code>  全部符合要求（我们项目是只判断输入框不为空就成）时候再对提交按钮做可点的操作。</p>
<p>​    目前我能想到的也就是针对每个<code>EditText</code> 添加 <code>TextWatcher</code>  然后再判断是否为空然后设置按钮的状态，怎么操作呢？设置几个 boolean 值每一个值对应一个文本框的状态符合为 <code>true</code> 不符合为 <code>false</code> ? 太 low 了不是么最后还要判断一堆的变量是否为 <code>true</code> ！</p>
<p>​    说下我的解决方案：逻辑运算，对就是这个东西大学学过逻辑电路相关课程一定对这东西不陌生，基本的运算有 与<code>&amp;</code>，或 <code>|</code> ，非 <code>~</code> ，异或<code>^</code> 等等，如果我想验证一个表单中包含三个输入 <code>111</code>  表示全部符合，<code>000</code> 表示全不符合，同理有其他几种情况不一一列举。</p>
<p>​    上代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">// @param flag 是一个文本是否满足验证条件</span></div><div class="line"><span class="comment">// @param n 是 EditText 标志</span></div><div class="line"><span class="comment">// 验证登录界面是否可用公用方法</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">validRegister</span><span class="params">(<span class="keyword">boolean</span> flag, <span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">  <span class="comment">// mTvRegister 是我的一个  Button 在符合条件时候可用</span></div><div class="line">  mTvRegister.setEnabled((flag ? (registerState ^= n) : (registerState |= n)) == <span class="number">7</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    上面这个是个公用方法调用的时候如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@OnTextChanged</span>(value = &#123; R.id.et_register_password &#125;, callback = OnTextChanged.Callback.TEXT_CHANGED)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRegister1</span><span class="params">(CharSequence s, <span class="keyword">int</span> start, <span class="keyword">int</span> before, <span class="keyword">int</span> count)</span> </span>&#123;</div><div class="line">  validRegister(TextUtils.isEmpty(s), <span class="number">1</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@OnTextChanged</span>(value = &#123; R.id.et_register_name &#125;, callback = OnTextChanged.Callback.TEXT_CHANGED)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRegister2</span><span class="params">(CharSequence s, <span class="keyword">int</span> start, <span class="keyword">int</span> before, <span class="keyword">int</span> count)</span> </span>&#123;</div><div class="line">  validRegister(TextUtils.isEmpty(s), <span class="number">2</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@OnTextChanged</span>(value = &#123; R.id.et_auth_code &#125;, callback = OnTextChanged.Callback.TEXT_CHANGED)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRegister3</span><span class="params">(CharSequence s, <span class="keyword">int</span> start, <span class="keyword">int</span> before, <span class="keyword">int</span> count)</span> </span>&#123;</div><div class="line">  validRegister(TextUtils.isEmpty(s), <span class="number">4</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    我用了<code>Butterknife</code> 简化了 <code>TextWatcher</code> 实现。关键就是 <code>n</code> 的值，我验证三个输入他们的值分别就是 <code>2</code>  的0，1，2 次方，N 个输入就到 N，公用方法内<code>boolean</code> 表达式值为 <code>2</code> 的 <code>N+1</code> 次方 减 <code>1</code> 我 验证是三个输入应该判断的值就是 <code>2</code>  的 <code>3</code> 次方 减  <code>1</code>  结果为 <code>7</code> 很简单吧。 其实还可以继续扩展通过这个 <code>int</code> 值知道我到底那个符合要求那个不符合。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://flyliufu.github.io/2017/05/26/Kotlin学习/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fu Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/9735870?v=3&u=33ed681a589c432a123bbdc242b25d56a1a0ac7b&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My way of learning">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/26/Kotlin学习/" itemprop="url">
                  Kotlin学习
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-26T09:29:44+08:00">
                2017-05-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/原创/" itemprop="url" rel="index">
                    <span itemprop="name">原创</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/05/26/Kotlin学习/" class="leancloud_visitors" data-flag-title="Kotlin学习">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://flyliufu.github.io/2017/03/29/Retrofit-OkHttp-多图文上传总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fu Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/9735870?v=3&u=33ed681a589c432a123bbdc242b25d56a1a0ac7b&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My way of learning">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/29/Retrofit-OkHttp-多图文上传总结/" itemprop="url">
                  Retrofit,OkHttp 多图文上传总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-29T14:19:15+08:00">
                2017-03-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2017/03/29/Retrofit-OkHttp-多图文上传总结/" class="leancloud_visitors" data-flag-title="Retrofit,OkHttp 多图文上传总结">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>​    最近在项目用到 <code>Retrofit2</code>  和 <code>OkHttp3</code> 整合做多图文上传遇到了一些问题整了半天搞的晕头转向终于搞定了，写个博文记录一下希望有人用到后可以帮助其解决遇到的问题。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 上传文件方法</div><div class="line"> * <span class="doctag">@param</span> path 路径</div><div class="line"> * <span class="doctag">@return</span> 服务器返回JSON</div><div class="line"> */</div><div class="line"><span class="meta">@POST</span> <span class="function">Observable&lt;String&gt; <span class="title">fileUpload</span><span class="params">(@Url String path, @Body RequestBody body)</span></span>;</div></pre></td></tr></table></figure>
<p>​    在接口类中声明该方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 上面接口类的实例调用该方法 </span></div><div class="line">ServicesAPI</div><div class="line"> .fileUpload(<span class="string">"request/path"</span>, filesToMultipartBodyParts(fileMap, params))</div><div class="line">.subscribeOn(Schedulers.io())</div><div class="line">.observeOn(AndroidSchedulers.mainThread())</div><div class="line"><span class="comment">// 处理返回的观察者，自己定义</span></div><div class="line">.subscribe(observer);</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 将文本类型，文件类型参数 转换成 MultipartBody</div><div class="line"> * <span class="doctag">@param</span> fileMap 文件路径</div><div class="line"> * <span class="doctag">@param</span> params  请求参数</div><div class="line"> */</div><div class="line"><span class="meta">@NonNull</span> <span class="function">MultipartBody <span class="title">filesToMultipartBodyParts</span><span class="params">(Map&lt;String, String&gt; fileMap,</span></span></div><div class="line">                                                 Map&lt;String, String&gt; params) &#123;</div><div class="line">  MultipartBody.Builder builder = <span class="keyword">new</span> MultipartBody.Builder();</div><div class="line">  <span class="keyword">if</span> (params != <span class="keyword">null</span> &amp;&amp; !params.isEmpty()) &#123;</div><div class="line">    <span class="comment">// 放置一般数据类型</span></div><div class="line">    <span class="keyword">for</span> (String key : params.keySet()) &#123;</div><div class="line">      builder.addFormDataPart(key, params.get(key));</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">if</span> (fileMap != <span class="keyword">null</span> &amp;&amp; !fileMap.isEmpty()) &#123;</div><div class="line">    <span class="comment">// 放置文件类型</span></div><div class="line">    <span class="keyword">for</span> (String key : fileMap.keySet()) &#123;</div><div class="line">      File file = <span class="keyword">new</span> File(fileMap.get(key));</div><div class="line">      <span class="keyword">if</span> (!file.exists()) &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(String.format(<span class="string">"File not found : %s."</span>, fileMap.get(key)));</div><div class="line">      &#125;</div><div class="line">      <span class="comment">// <span class="doctag">TODO:</span> 16-4-2  这里为了简单起见，没有判断file的类型</span></div><div class="line">      RequestBody requestBody = RequestBody.create(MediaType.parse(<span class="string">"image/png"</span>), file);</div><div class="line">      builder.addFormDataPart(key, file.getName(), requestBody);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> builder.setType(MultipartBody.FORM).build();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    其后就可以开心的上传文件了，有问题欢迎交流。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://flyliufu.github.io/2017/03/25/算法学习总结1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fu Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/9735870?v=3&u=33ed681a589c432a123bbdc242b25d56a1a0ac7b&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My way of learning">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/25/算法学习总结1/" itemprop="url">
                  算法学习总结1
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-25T09:51:17+08:00">
                2017-03-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/原创/" itemprop="url" rel="index">
                    <span itemprop="name">原创</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/03/25/算法学习总结1/" class="leancloud_visitors" data-flag-title="算法学习总结1">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="公用代码"><a href="#公用代码" class="headerlink" title="公用代码"></a>公用代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 判断 v 是否小于 w</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">less</span><span class="params">(Comparable v, Comparable w)</span> </span>&#123;</div><div class="line">  <span class="keyword">return</span> v.compareTo(w) &lt; <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// i j 元素交换位置</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exch</span><span class="params">(Comparable[] a, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</div><div class="line">  Comparable t = a[i];</div><div class="line">  a[i] = a[j];</div><div class="line">  a[j] = t;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 展示一个继承了Comparable 接口的数组</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(Comparable[] a)</span> </span>&#123;</div><div class="line">  <span class="keyword">for</span> (Comparable anA : a) System.out.print(anA + <span class="string">"  "</span>);</div><div class="line">  System.out.println();</div><div class="line">&#125;</div><div class="line"><span class="comment">// 判断数组是否已经有序</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSorted</span><span class="params">(Comparable[] a)</span> </span>&#123;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; a.length; i++) &#123;</div><div class="line">    <span class="keyword">if</span> (less(a[i], a[i - <span class="number">1</span>])) <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    以上几个方法贯穿所有关于排序算法总结。</p>
<h4 id="选择排序"><a href="#选择排序" class="headerlink" title="选择排序"></a>选择排序</h4><h5 id="JAVA实现代码"><a href="#JAVA实现代码" class="headerlink" title="JAVA实现代码"></a>JAVA实现代码</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(Comparable[] a)</span> </span>&#123;</div><div class="line">  <span class="keyword">int</span> N = a.length; </div><div class="line">  <span class="comment">// 升序排列</span></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">    <span class="comment">//先假设数组中第一个元素是最小值</span></div><div class="line">    <span class="keyword">int</span> min = i; </div><div class="line">    <span class="comment">// 将 a[i] 和 a[1,2,...N] 中最小的交换</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span>; j &lt; N; j++) &#123;</div><div class="line">      <span class="comment">// 如果发现 j 元素比 min 元素小将 min 下标重新赋值</span></div><div class="line">      <span class="keyword">if</span> (less(a[j], a[min])) min = j;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 查找完所有元素后将 i 和最小元素交换位置</span></div><div class="line">    exch(a, i, min);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="时间复杂度"><a href="#时间复杂度" class="headerlink" title="时间复杂度"></a>时间复杂度</h5><p>O(n<sup>2</sup>)</p>
<h5 id="稳定性"><a href="#稳定性" class="headerlink" title="稳定性"></a>稳定性</h5><p>不稳定</p>
<h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><p>​    选择排序总是需要把无序的数组元素统统循环一遍后找到最小的一个数，将这个娄放到已经排好序的元素位置后面这样可能会做很多无用的比较，效率上不是最优的，实际应用场景也并不多。</p>
<hr>
<h4 id="插入排序"><a href="#插入排序" class="headerlink" title="插入排序"></a>插入排序</h4><h5 id="JAVA实现代码-1"><a href="#JAVA实现代码-1" class="headerlink" title="JAVA实现代码"></a>JAVA实现代码</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(Comparable[] a)</span> </span>&#123;</div><div class="line">  <span class="keyword">int</span> N = a.length;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; N; i++) &#123;</div><div class="line">    <span class="comment">// 如果 j 元素比 j - 1 元素小那么就交换元素位置</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &gt; <span class="number">0</span> &amp;&amp; less(a[j], a[j - <span class="number">1</span>]); j--) &#123;</div><div class="line">      <span class="comment">// 交换元素位置</span></div><div class="line">      exch(a, j, j - <span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="时间复杂度-1"><a href="#时间复杂度-1" class="headerlink" title="时间复杂度"></a>时间复杂度</h5><p>O(n<sup>2</sup>)</p>
<h5 id="稳定性-1"><a href="#稳定性-1" class="headerlink" title="稳定性"></a>稳定性</h5><p>稳定</p>
<h5 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h5><p>​    <strong>特别说明一下本算法对基本有序数组排序效果非常好</strong></p>
<p>​    插入排序有人形象的比喻成玩扑克时候捋牌，当手上有一张牌时肯定是在第一位，抓到第二张时候需要和第一张比较一下如果大于位置不动，小于插入前面，再抓一张牌和第二张比较小于放前，大于位置不动，但这时候前面还有一张牌不确定是否比新抓的牌小所以还要比较一次小于放前，大于位置不动，这样可以保证三张牌是肯定有序的，依次类推直到牌全部抓完手中的牌也全部都是有序的。 </p>
<hr>
<h4 id="希尔排序"><a href="#希尔排序" class="headerlink" title="希尔排序"></a>希尔排序</h4><h5 id="JAVA实现代码-2"><a href="#JAVA实现代码-2" class="headerlink" title="JAVA实现代码"></a>JAVA实现代码</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(Comparable[] a)</span> </span>&#123;</div><div class="line">  <span class="keyword">int</span> N = a.length;</div><div class="line">  <span class="keyword">int</span> step = <span class="number">3</span>;</div><div class="line">  <span class="keyword">int</span> h = <span class="number">1</span>;</div><div class="line">  <span class="keyword">while</span> (h &lt; N / step) &#123;</div><div class="line">    <span class="comment">// 计算最大步长</span></div><div class="line">    h = step * h + <span class="number">1</span>; <span class="comment">// 1,4,13,40,121,364,1093 ...</span></div><div class="line">  &#125;</div><div class="line">  <span class="comment">// 判断步长是否为大于等于1</span></div><div class="line">  <span class="keyword">while</span> (h &gt;= <span class="number">1</span>) &#123;</div><div class="line">    <span class="comment">// 遍历全部数组中的元素，起始值是步长例如 h = 13, i = 13</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = h; i &lt; N; i++) &#123;</div><div class="line">      <span class="comment">// 判断相距 h 个元素的两个元素的大小情况，如果后者小于前者交换位置</span></div><div class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &gt;= h &amp;&amp; less(a[j], a[j - h]); j -= h) &#123;</div><div class="line">        exch(a, j, j - h);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    h /= step;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="时间复杂度-2"><a href="#时间复杂度-2" class="headerlink" title="时间复杂度"></a>时间复杂度</h5><p>最好：O(nlog<sup>2</sup>n)、最坏：O(n<sup>2</sup>)</p>
<h5 id="稳定性-2"><a href="#稳定性-2" class="headerlink" title="稳定性"></a>稳定性</h5><p>不稳定</p>
<h5 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h5><p>​    希尔排序是对插入排序的一次改进后者的优点就是在数组基本处于有序的时候排序效果很好，但乱序的时候并不理想，希尔排序改进了这点提出一个步长的设计思想，有这样一种可能就是长度 <code>1000</code> 的数组可能第1000个数最终的位置是在第一位这也是最糟糕的情况，单单排列这一个数就需要移动 <code>999</code> 次比较 <code>999</code> 次，这样实在是效率太低了，低于选择排序。</p>
<p>​    步长这个操作就很好解决了这个问题通过这个操作把最后一个元素移到第一位针对这个元素的比较、移动次数只是个位级别就完成了。以代码中的中长为例，一个长度 <code>20</code> 的数组排序步长分别是 <code>1</code> 、<code>4</code>、 <code>13</code> 开始比较是拿第<code>1</code> 个元素和第 <code>14</code> 元素比较 小于互换位置，大于位置不动，然后再用 <code>2</code> 和 <code>15</code> 元素比较最后是 <code>7</code> 和 <code>20</code> ，假设第20是最小值，这时候他只比较一次就已经换到第 <code>7</code> 的位置了这和插入排序相比已经少做了很多次比较、交换，希尔排序的思路就是如此，大家可能注意到希尔排序最重要的是这个步长的设计，步长设计的好可以直接提高排序性能，的确是这样的，已知的最好步长<a href="http://faculty.simpson.edu/lydia.sinapova/www/cmsc250/LN250_Weiss/L12-ShellSort.htm#increments" target="_blank" rel="external">序列</a>是由Sedgewick提出的是由两个算式计算得出。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://flyliufu.github.io/2017/03/13/batchRemove方法分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fu Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/9735870?v=3&u=33ed681a589c432a123bbdc242b25d56a1a0ac7b&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My way of learning">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/13/batchRemove方法分析/" itemprop="url">
                  batchRemove方法分析
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-13T16:46:58+08:00">
                2017-03-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/原创/" itemprop="url" rel="index">
                    <span itemprop="name">原创</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/03/13/batchRemove方法分析/" class="leancloud_visitors" data-flag-title="batchRemove方法分析">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>​        <code>batchRemove</code> 这个方法是个 <code>private</code> 修饰只能在类内部用，主要用在了<code>removeAll(Collection, Boolean)</code>， <code>retainAll(Collection, Boolean)</code> 这两个方法中，根据第二个参数来决定是只删除集合中数据，还是只保留集合中的数据。</p>
<p>​    先说变量定义：这里定义一个<code>final</code> 的 <code>Object</code> 数组来接成员变量中的数组中的值（有什么意义啊？不太明白），还有两个 <code>int</code> 类型的变量 记录读<code>r</code>  和 写 <code>w</code> 还有个 <code>boolean</code> 值记录修改成功标志，<code>try</code>  块中只有一个 <code>for</code> 循环，它的作用是遍历当前数组，然后判断参数集合中是否包含当前的元素是否进 <code>if</code> 就要看参数传的是 <code>true</code> 还是 <code>false</code> 了，不管怎么样只要进了 <code>if</code> 里面后有个操作是把 同一个数组中 <code>w</code> 位置的元素覆盖成 <code>r</code> 位置的元素因为不管<code>r</code> 的是多少进<code>if</code> 块  <code>w</code> 肯定是从<code>0</code>开始的，这样就做到了只保留或只删除集合中的元素的功能（太牛逼了= =，我原来实现这个功能还是创建两个数组。。。）注意走完循环后 <code>r</code> ，<code>w</code> 的值肯定是小于或等于 <code>size</code> 的，</p>
<p>​    为了方便先模拟一个环境</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyArrayList</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> modCount = <span class="number">0</span>;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> size = <span class="number">6</span>;</div><div class="line">	<span class="keyword">private</span> Object[] elementData = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span> &#125;;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">batchRemove</span><span class="params">(Collection&lt;?&gt; c, <span class="keyword">boolean</span> complement)</span> </span>&#123;</div><div class="line">		<span class="keyword">final</span> Object[] elementData = <span class="keyword">this</span>.elementData;</div><div class="line">		<span class="keyword">int</span> r = <span class="number">0</span>, w = <span class="number">0</span>;</div><div class="line">		<span class="keyword">boolean</span> modified = <span class="keyword">false</span>;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="keyword">for</span> (; r &lt; size; r++)</div><div class="line">				<span class="keyword">if</span> (c.contains(elementData[r]) == complement) &#123;</div><div class="line">					elementData[w++] = elementData[r];</div><div class="line">				&#125;</div><div class="line">			System.out.println(String.format(<span class="string">"r value is %d, r value is %d"</span>, r, w));</div><div class="line">		&#125; <span class="keyword">finally</span> &#123;</div><div class="line">			<span class="comment">// Preserve behavioral compatibility with AbstractCollection,</span></div><div class="line">			<span class="comment">// even if c.contains() throws.</span></div><div class="line">			<span class="keyword">if</span> (r != size) &#123;</div><div class="line">				System.arraycopy(elementData, r, elementData, w, size - r);</div><div class="line">				w += size - r;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">if</span> (w != size) &#123;</div><div class="line">				<span class="comment">// clear to let GC do its work</span></div><div class="line">				<span class="keyword">for</span> (<span class="keyword">int</span> i = w; i &lt; size; i++)</div><div class="line">					elementData[i] = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">				modCount += size - w;</div><div class="line">				size = w;</div><div class="line">				modified = <span class="keyword">true</span>;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> modified;</div><div class="line">	&#125;</div><div class="line"> 	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">retainAll</span><span class="params">(Collection&lt;?&gt; c)</span> </span>&#123;</div><div class="line">		Objects.requireNonNull(c);</div><div class="line">		<span class="keyword">return</span> batchRemove(c, <span class="keyword">true</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">removeAll</span><span class="params">(Collection&lt;?&gt; c)</span> </span>&#123;</div><div class="line">		Objects.requireNonNull(c);</div><div class="line">		<span class="keyword">return</span> batchRemove(c, <span class="keyword">false</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    里面的数据是写死的这不重要。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">  MyArrayList array = <span class="keyword">new</span> MyArrayList();</div><div class="line">  ArrayList&lt;Integer&gt; collection = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">  collection.add(<span class="number">1</span>);</div><div class="line">  collection.add(<span class="number">2</span>);</div><div class="line">  collection.add(<span class="number">3</span>);</div><div class="line">  array.retainAll(collection);</div><div class="line">&#125;</div><div class="line"><span class="comment">// 输出： r value is 6, w value is 3</span></div></pre></td></tr></table></figure>
<p>​    大概可以理解为 <code>retainAll()</code>  一共做了六次读取操作，其中有三次读取同时做了写入操作。最后数组中也只保留了两个数组的相同的部分，同理 <code>removeAll()</code> 最后结果是只删除了两个集合相同的部分有一点说明一下，在 <code>batchRemove()</code> 处理完数据后有一步操作是把数组中多余出来的空间置空的操作</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="number">1</span></div><div class="line"><span class="number">2</span></div><div class="line"><span class="number">3</span></div><div class="line"><span class="keyword">null</span></div><div class="line"><span class="keyword">null</span></div><div class="line"><span class="keyword">null</span></div></pre></td></tr></table></figure>
<p>​    <code>retainAll()</code> 操作结束后原来有六个空间，只剩下了3个元素空下来3个空间被置为了 <code>null</code>  等待 <code>GC</code> 回收操作，但这时候我们也可以手动去释放这些空间，还记得之前说到一个方法 <code>trimToSize()</code> 在这用到了，调用一下这个方法，释放一些本来就不多的手机内存吧。（这个方法我也只明白了一部分，在 <code>finally</code> 块中的代码有些不太理解，希望有兴趣的同学一起来讨论下~~）</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://flyliufu.github.io/2017/03/12/JAVA源码学习之ArrayList-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fu Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/9735870?v=3&u=33ed681a589c432a123bbdc242b25d56a1a0ac7b&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My way of learning">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/12/JAVA源码学习之ArrayList-3/" itemprop="url">
                  JAVA源码学习之ArrayList(3)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-12T22:08:01+08:00">
                2017-03-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/原创/" itemprop="url" rel="index">
                    <span itemprop="name">原创</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/03/12/JAVA源码学习之ArrayList-3/" class="leancloud_visitors" data-flag-title="JAVA源码学习之ArrayList(3)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="retainAll-amp-removeAll"><a href="#retainAll-amp-removeAll" class="headerlink" title="retainAll &amp; removeAll"></a>retainAll &amp; removeAll</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">retainAll</span><span class="params">(Collection&lt;?&gt; c)</span> </span>&#123;</div><div class="line">  Objects.requireNonNull(c);</div><div class="line">  <span class="keyword">return</span> batchRemove(c, <span class="keyword">true</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">removeAll</span><span class="params">(Collection&lt;?&gt; c)</span> </span>&#123;</div><div class="line">  Objects.requireNonNull(c);</div><div class="line">  <span class="keyword">return</span> batchRemove(c, <span class="keyword">false</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    这两个方法是一对没什么可讲的主要是子方法    <code>batchRemove</code>  有些难懂我放在了另一个<a href="/2017/03/13/batchRemove方法分析/">博客</a>中分析，希望有想法的朋友可以一起讨论。</p>
<h3 id="add"><a href="#add" class="headerlink" title="add"></a>add</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, E element)</span> </span>&#123;</div><div class="line">  <span class="comment">// 检查 index 的数值是否合法</span></div><div class="line">  rangeCheckForAdd(index);</div><div class="line">  <span class="comment">// 保证容量有位置可以放下接下来的一个元素</span></div><div class="line">  ensureCapacityInternal(size + <span class="number">1</span>);  <span class="comment">// Increments modCount!!</span></div><div class="line">  <span class="comment">// (1)</span></div><div class="line">  System.arraycopy(elementData, index, elementData, index + <span class="number">1</span>, size - index);</div><div class="line">  <span class="comment">// (2)</span></div><div class="line">  elementData[index] = element;</div><div class="line">  size++;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    (1) 在确保有了足够的位置后调用 <code>System.arraycopy</code> 方法把 <code>index</code> 位置的元素整体向后移一位，这样就把 <code>index</code> 位置的数据空出来了。</p>
<p>​    (2) 把传入的参数覆盖原来的数据这样就实现了在固定位添加元素功能，最后把 <code>size</code> 自增。</p>
<h3 id="remove"><a href="#remove" class="headerlink" title="remove"></a>remove</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> E <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</div><div class="line">  rangeCheck(index);</div><div class="line">  modCount++;</div><div class="line">  <span class="comment">// 保存下将要删除元素</span></div><div class="line">  E oldValue = elementData(index);</div><div class="line">  <span class="comment">// 计算需要移动的元素个数</span></div><div class="line">  <span class="keyword">int</span> numMoved = size - index - <span class="number">1</span>;</div><div class="line">  <span class="comment">// 如果需要移动个数大于0，有可能等于0， 但不会小于0</span></div><div class="line">  <span class="keyword">if</span> (numMoved &gt; <span class="number">0</span>) &#123;</div><div class="line">    <span class="comment">// (3)</span></div><div class="line">    System.arraycopy(elementData, index + <span class="number">1</span>, elementData, index, numMoved);</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// 把最后一个元素置空</span></div><div class="line">  elementData[--size] = <span class="keyword">null</span>; <span class="comment">// clear to let GC do its work</span></div><div class="line">  <span class="comment">// 返回已经删除的元素</span></div><div class="line">  <span class="keyword">return</span> oldValue;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    (3) 这句话就是说把从 <code>index + 1</code> 开始 <code>numMoved</code> 个元素重新放入 <code>elementData</code> 中 从 <code>index</code> 位置开始中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object o)</span> </span>&#123;</div><div class="line">  <span class="keyword">if</span> (o == <span class="keyword">null</span>) &#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt; size; index++)</div><div class="line">      <span class="keyword">if</span> (elementData[index] == <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="comment">// 如果为空遍历数组把第一个为空的元素移除返回  true</span></div><div class="line">        fastRemove(index);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">      &#125;</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span>; index &lt; size; index++)</div><div class="line">      <span class="keyword">if</span> (o.equals(elementData[index])) &#123;</div><div class="line">        <span class="comment">// 不为空时候查找到和对象相等的情况下再移除，返回 true</span></div><div class="line">        fastRemove(index);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">      &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 私有删除方法，不检查下标界限并且不返回删除元素</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">fastRemove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</div><div class="line">  <span class="comment">// 该方法大致和 remove 相同只是为了速度不去做校验，不返回</span></div><div class="line">  modCount++;</div><div class="line">  <span class="keyword">int</span> numMoved = size - index - <span class="number">1</span>;</div><div class="line">  <span class="keyword">if</span> (numMoved &gt; <span class="number">0</span>) &#123;</div><div class="line">    System.arraycopy(elementData, index + <span class="number">1</span>, elementData, index, numMoved);</div><div class="line">  &#125;</div><div class="line">  elementData[--size] = <span class="keyword">null</span>; <span class="comment">// clear to let GC do its work</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="addAll"><a href="#addAll" class="headerlink" title="addAll"></a>addAll</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addAll</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</div><div class="line">  <span class="comment">// 转换成数组</span></div><div class="line">  Object[] a = c.toArray();</div><div class="line">  <span class="comment">// 获得添加数组的长度</span></div><div class="line">  <span class="keyword">int</span> numNew = a.length;</div><div class="line">  <span class="comment">// 确定有足够的空间存放数据</span></div><div class="line">  ensureCapacityInternal(size + numNew);  <span class="comment">// Increments modCount</span></div><div class="line">  <span class="comment">// 在当前数组后面追加 numNew 个元素</span></div><div class="line">  System.arraycopy(a, <span class="number">0</span>, elementData, size, numNew);</div><div class="line">  <span class="comment">// 更新当前数组的 size 个数</span></div><div class="line">  size += numNew;</div><div class="line">  <span class="comment">// 如果参数数组长度不为0 返回true</span></div><div class="line">  <span class="keyword">return</span> numNew != <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addAll</span><span class="params">(<span class="keyword">int</span> index, Collection&lt;? extends E&gt; c)</span> </span>&#123;</div><div class="line">  rangeCheckForAdd(index);</div><div class="line">  Object[] a = c.toArray();</div><div class="line">  <span class="keyword">int</span> numNew = a.length;</div><div class="line">  ensureCapacityInternal(size + numNew);  <span class="comment">// Increments modCount</span></div><div class="line">  <span class="comment">// 结果是大于等于0的一个值，如果是等于0 就是在末尾追加</span></div><div class="line">  <span class="keyword">int</span> numMoved = size - index;</div><div class="line">  <span class="keyword">if</span> (numMoved &gt; <span class="number">0</span>) &#123;</div><div class="line">    <span class="comment">// 这块的逻辑同 add 只是 add 是移动了一个位置，</span></div><div class="line">    <span class="comment">// 而这需要移动 index + numNew 个元素来存放参数数组中的元素</span></div><div class="line">    System.arraycopy(elementData, index, elementData, index + numNew, numMoved);</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// 把 a 中的 numNew 个元素追加到 elementData 中 index 开始里面</span></div><div class="line">  System.arraycopy(a, <span class="number">0</span>, elementData, index, numNew);</div><div class="line">  <span class="comment">// 更新 size 长度</span></div><div class="line">  size += numNew;</div><div class="line">  <span class="keyword">return</span> numNew != <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="removeRange"><a href="#removeRange" class="headerlink" title="removeRange"></a>removeRange</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 移除一段区域中的数据 </span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">removeRange</span><span class="params">(<span class="keyword">int</span> fromIndex, <span class="keyword">int</span> toIndex)</span> </span>&#123;</div><div class="line">  modCount++;</div><div class="line">  <span class="comment">// 计算需要移动数据个数</span></div><div class="line">  <span class="keyword">int</span> numMoved = size - toIndex;</div><div class="line">  <span class="comment">// 将 elementData toIndex 开始的数据覆盖成 elementData 从 fromIndex 开始 到结束 numMoved 个元素</span></div><div class="line">  System.arraycopy(elementData, toIndex, elementData, fromIndex, numMoved);</div><div class="line">  <span class="comment">// clear to let GC do its work</span></div><div class="line">  <span class="comment">//计算下新数组的长度</span></div><div class="line">  <span class="keyword">int</span> newSize = size - (toIndex - fromIndex);</div><div class="line">  <span class="comment">// 把没有用到的空间元素置空，可以让GC working</span></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = newSize; i &lt; size; i++) &#123;</div><div class="line">    elementData[i] = <span class="keyword">null</span>;</div><div class="line">  &#125;</div><div class="line">  size = newSize; <span class="comment">//重新定义长度</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://flyliufu.github.io/2017/03/10/copyOf相关方法总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fu Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/9735870?v=3&u=33ed681a589c432a123bbdc242b25d56a1a0ac7b&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My way of learning">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/10/copyOf相关方法总结/" itemprop="url">
                  copyOf相关方法总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-10T15:23:46+08:00">
                2017-03-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/原创/" itemprop="url" rel="index">
                    <span itemprop="name">原创</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/03/10/copyOf相关方法总结/" class="leancloud_visitors" data-flag-title="copyOf相关方法总结">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="copyOf"><a href="#copyOf" class="headerlink" title="copyOf"></a>copyOf</h1><p>​    在学习 <code>ArrayList</code> 时候遇到很多地方全用到了 <code>Arrays.copyOf()</code> 方法，搞不清楚这个方法感觉学习 <code>ArrayList</code> 会遇到一些阅读困难啊，所以专门写个关于这个方法及相关方法的学习贴吧。</p>
<p>​    <code>copyOf()</code> 及其相关方法如此之多光这一个方法就有五六个重载方法但万变不离其宗其实重载方法的含义是一样，这只把几个特殊的方法拿出来研究一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T[] copyOf(T[] original, <span class="keyword">int</span> newLength) &#123;</div><div class="line">  <span class="keyword">return</span> (T[]) copyOf(original, newLength, original.getClass());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    这个方法没什么可说的主要就是调用了一下本类中的另一个方法然后强转下泛型<code>T[]</code> ，接下来看下这个关键的引用 方法是怎么个实现方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T, U&gt; T[] copyOf(U[] original, <span class="keyword">int</span> newLength, Class&lt;? extends T[]&gt; newType) &#123;</div><div class="line">  <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</div><div class="line">  T[] copy = ((Object) newType == (Object) Object[].class) ? (T[]) <span class="keyword">new</span> Object[newLength] :</div><div class="line">  (T[]) Array.newInstance(newType.getComponentType(), newLength);</div><div class="line"></div><div class="line">  System.arraycopy(original, <span class="number">0</span>, copy, <span class="number">0</span>, Math.min(original.length, newLength));</div><div class="line">  <span class="keyword">return</span> copy;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    这个方法牛逼大了啊，泛型还是两个首先来解释下参数第一个是原始数组参数，第二个参数是新数组的长度，第三个参数是生成后新数组类的类型这个类型必须是个数组类型像 <code>String[].getClass()</code>，<code>Integer[].getClass()</code>，<code>Number[].getClass()</code>，等都可以，但不可以是<code>String.getClass()</code>这种类型好吧，很容易理解。方法代码部分第一句话有点长用了一个三目运算符条件是参数类型是否是<code>Object[]</code> 类型 如果是就直接实例化出一个<code>Object[]</code> 数组长为 <code>newLength</code> ，如果不是。。。就创建出一个数组，<code>Class.getComponentType()</code> 该方法只有当参数是个数组的时候才返回值如果不是数组只返回 <code>null</code> ，不懂就自己写个例子看看。</p>
<p>​    上一步最终会创建出一个数组，然后调用 <code>System.arraycopy([],int,[],int,int)</code> 这个方法没什么可说的，主要是最后一个参数是告诉方法复制的数组长度是多少，最后返回创建的数组这个方法叫 <code>copyOf</code> 但看方法实现更像是 <code>newAndCopyOf</code> 我是这么理解的有更好的请指点一二谢谢。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] copyOf(<span class="keyword">byte</span>[] original, <span class="keyword">int</span> newLength) &#123;</div><div class="line">  <span class="keyword">byte</span>[] copy = <span class="keyword">new</span> <span class="keyword">byte</span>[newLength];</div><div class="line">  System.arraycopy(original, <span class="number">0</span>, copy, <span class="number">0</span>, Math.min(original.length, newLength));</div><div class="line">  <span class="keyword">return</span> copy;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    还有很多这种重载方法，但除了类型不一样其他的都是一样的只看一个就可以了，而且这个方法好像也不难。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://flyliufu.github.io/2017/03/08/ArrayList方法clone探究/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fu Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/9735870?v=3&u=33ed681a589c432a123bbdc242b25d56a1a0ac7b&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My way of learning">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/08/ArrayList方法clone探究/" itemprop="url">
                  ArrayList方法clone探究
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-08T22:39:37+08:00">
                2017-03-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/原创/" itemprop="url" rel="index">
                    <span itemprop="name">原创</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/03/08/ArrayList方法clone探究/" class="leancloud_visitors" data-flag-title="ArrayList方法clone探究">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line">	<span class="comment">// 源数组</span></div><div class="line">	<span class="keyword">static</span> ArrayList&lt;Bean&gt; beans = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">	<span class="comment">// 目标数组</span></div><div class="line">	<span class="keyword">static</span> ArrayList&lt;Bean&gt; copyBeans = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bean</span> </span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">int</span> i;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    期望是将 <code>beans</code> 中的数据复制到 <code>copyBeans</code> 集合中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</div><div class="line">    beans.add(<span class="keyword">new</span> Bean(i));</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​        ·<code>init()</code>方法中我循环创建了<code>10</code> 个对象添加到<code>beans</code> 集合中备用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">  init();</div><div class="line">  copyBeans = (ArrayList&lt;Bean&gt;) beans.clone();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    初始化集合，然后 copy 集合数据赋值给另一个<code>ArrayList</code> 对象实例。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">System.out.println(beans == copyBeans); <span class="comment">//false</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; beans.size(); i++) &#123;</div><div class="line">  System.out.println(beans.get(i).equals(copyBeans.get(i))); <span class="comment">// true</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; beans.size(); i++) &#123;</div><div class="line">  System.out.println(beans.get(i) == copyBeans.get(i)); <span class="comment">// true</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    来看下这几行代码运行结果第一个是<code>false</code> 可以理解是经过 <code>clone()</code> 确实是克隆了一份给了<code>copyBeans</code>，接下来这个也不难懂<code>equals(Object)</code> 这里的<code>equals()</code> 用的是<code>Object</code> 类中的方法，而<code>Object</code> 中这个方法实现实际 就是用 <code>==</code> 来判断和下面这个判断方法其实是一样的，那么在 <code>Java</code> 中对象如果相等证明他们所用的内存是一样的，那是不是这样的用代码来说话（具体这个 <code>equals()</code> 方法介绍请看<a href="http://www.cnblogs.com/chenssy/p/3416195.html" target="_blank" rel="external">这里</a> ）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; beans.size(); i++) &#123;</div><div class="line">  beans.get(i).i = i + <span class="number">3</span>;</div><div class="line">  System.out.println(copyBeans.get(i).i);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    我给源数组 <code>beans</code> 循环加 <code>3</code> 然后把同位置目标数组中的值打印输出结果所示:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="number">3</span></div><div class="line"><span class="number">4</span></div><div class="line"><span class="number">5</span></div><div class="line"><span class="number">6</span></div><div class="line"><span class="number">7</span></div><div class="line"><span class="number">8</span></div><div class="line"><span class="number">9</span></div><div class="line"><span class="number">10</span></div><div class="line"><span class="number">11</span></div><div class="line"><span class="number">12</span></div></pre></td></tr></table></figure>
<p>​    也就充值证明了 <code>clone()</code> 后只是开辟了一个空间引用，其真正所指向的还是原来数组的内存空间只要任意一个数组有改变操作另一个也会受到影响这也就是官方注释上说的 Shallow copy。</p>
<p>​    虽然这个搞明白了但工作中有的时候确实有这个需要<code>clone()</code> 出一个新的数组做操作但又不影响源数组的数据该怎么办呢？我也是个菜鸟目前我能想到的办法也很低级如果拉低了读到博客的人的智商表示抱歉。。。</p>
<p>​    首先在 <code>Bean</code> 类中增加一个构造函数，参数是本类，然后把参数中的值对应的赋到对应的属性中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">Bean</span><span class="params">(Bean bean)</span> </span>&#123;</div><div class="line">  <span class="keyword">this</span>.i = bean.i;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    创建克隆方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">static</span> ArrayList&lt;Bean&gt; <span class="title">myClone</span><span class="params">(ArrayList&lt;Bean&gt; beans)</span> </span>&#123;</div><div class="line">  ArrayList&lt;Bean&gt; localBeans = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; beans.size(); i++) &#123;</div><div class="line">    localBeans.add(<span class="keyword">new</span> Bean(beans.get(i)));</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> localBeans;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    替换原来的克隆方法改为自定义的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// copyBeans = (ArrayList&lt;Bean&gt;) beans.clone();</span></div><div class="line">copyBeans = myClone(beans);</div></pre></td></tr></table></figure>
<p>​    剩下的不变再把代码运行一次会发现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">false</span></div><div class="line"><span class="keyword">false</span></div><div class="line"><span class="keyword">false</span></div><div class="line"><span class="keyword">false</span></div><div class="line"><span class="keyword">false</span></div><div class="line"><span class="keyword">false</span></div><div class="line"><span class="keyword">false</span></div><div class="line"><span class="keyword">false</span></div><div class="line"><span class="keyword">false</span></div><div class="line"><span class="keyword">false</span></div><div class="line"><span class="keyword">false</span></div><div class="line"><span class="keyword">false</span></div><div class="line"><span class="keyword">false</span></div><div class="line"><span class="keyword">false</span></div><div class="line"><span class="keyword">false</span></div><div class="line"><span class="keyword">false</span></div><div class="line"><span class="keyword">false</span></div><div class="line"><span class="keyword">false</span></div><div class="line"><span class="keyword">false</span></div><div class="line"><span class="keyword">false</span></div><div class="line"><span class="keyword">false</span></div><div class="line"><span class="number">0</span></div><div class="line"><span class="number">1</span></div><div class="line"><span class="number">2</span></div><div class="line"><span class="number">3</span></div><div class="line"><span class="number">4</span></div><div class="line"><span class="number">5</span></div><div class="line"><span class="number">6</span></div><div class="line"><span class="number">7</span></div><div class="line"><span class="number">8</span></div><div class="line"><span class="number">9</span></div></pre></td></tr></table></figure>
<p>​    哈两个数组完全不会互相干扰了，想怎么改不会影响对方了~~</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://flyliufu.github.io/2017/03/08/JAVA源码学习之ArrayList-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Fu Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/9735870?v=3&u=33ed681a589c432a123bbdc242b25d56a1a0ac7b&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="My way of learning">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/08/JAVA源码学习之ArrayList-2/" itemprop="url">
                  JAVA源码学习之ArrayList(2)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-08T21:17:13+08:00">
                2017-03-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/原创/" itemprop="url" rel="index">
                    <span itemprop="name">原创</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/03/08/JAVA源码学习之ArrayList-2/" class="leancloud_visitors" data-flag-title="JAVA源码学习之ArrayList(2)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>​    继续上篇博客学习<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">indexOf</span><span class="params">(Object o)</span> </span>&#123;</div><div class="line">  <span class="keyword">if</span> (o == <span class="keyword">null</span>) &#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++)</div><div class="line">      <span class="keyword">if</span> (elementData[i] == <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">return</span> i;</div><div class="line">      &#125;</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++)</div><div class="line">      <span class="keyword">if</span> (o.equals(elementData[i])) &#123;</div><div class="line">        <span class="keyword">return</span> i;</div><div class="line">      &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lastIndexOf</span><span class="params">(Object o)</span> </span>&#123;</div><div class="line">  <span class="keyword">if</span> (o == <span class="keyword">null</span>) &#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = size - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</div><div class="line">      <span class="keyword">if</span> (elementData[i] == <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">return</span> i;</div><div class="line">      &#125;</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = size - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)</div><div class="line">      <span class="keyword">if</span> (o.equals(elementData[i])) &#123;</div><div class="line">        <span class="keyword">return</span> i;</div><div class="line">      &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>​    名称上来看是用来查找一个元素是否存在数组中，如果找不到返回 <code>-1</code> ，当查找的元素为 <code>null</code> 时候遍历数组中的元素把第一个为 <code>null</code> 的元素下标返回，如果不为空依旧是遍历数组后找到对象和元素值对应第一个的下标返回，下面是查找最后一个和对象相等元素的下标基本和上一个方法原理一样，只是这个方法是从后往前遍历而已。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Returns a shallow copy of this &lt;tt&gt;ArrayList&lt;/tt&gt; instance.  (The</div><div class="line"> * elements themselves are not copied.)</div><div class="line"> *</div><div class="line"> * <span class="doctag">@return</span> a clone of this &lt;tt&gt;ArrayList&lt;/tt&gt; instance</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">clone</span><span class="params">()</span> </span>&#123;</div><div class="line">  <span class="keyword">try</span> &#123;</div><div class="line">    ArrayList&lt;?&gt; v = (ArrayList&lt;?&gt;) <span class="keyword">super</span>.clone();</div><div class="line">    v.elementData = Arrays.copyOf(elementData, size);</div><div class="line">    v.modCount = <span class="number">0</span>;</div><div class="line">    <span class="keyword">return</span> v;</div><div class="line">  &#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</div><div class="line">    <span class="comment">// this shouldn't happen, since we are Cloneable</span></div><div class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> InternalError(e);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    <code>clone()</code>  虽说没几行代码但还确实有点难懂，也许需要个<a href="/2017/03/08/ArrayList方法clone探究/">例子</a>来辅助来理解这个方法了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</div><div class="line"><span class="keyword">public</span> &lt;T&gt; T[] toArray(T[] a) &#123;</div><div class="line">  <span class="keyword">if</span> (a.length &lt; size)</div><div class="line">  <span class="comment">// Make a new array of a's runtime type, but my contents:</span></div><div class="line">  &#123;</div><div class="line">    <span class="keyword">return</span> (T[]) Arrays.copyOf(elementData, size, a.getClass());</div><div class="line">  &#125;</div><div class="line">  System.arraycopy(elementData, <span class="number">0</span>, a, <span class="number">0</span>, size);</div><div class="line">  <span class="keyword">if</span> (a.length &gt; size) &#123;</div><div class="line">    a[size] = <span class="keyword">null</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> a;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​    <code>toArray(T[])</code> 看到这个方法很是懵啊，<code>ArrayList&lt;E&gt;</code> 声明时候是用的 <code>E</code> 这个方法怎么是用的 <code>T</code> 很是不理解这种设计的思路上网查了些<a href="http://www.cnblogs.com/xiaomiganfan/p/5362732.html" target="_blank" rel="external">资料</a>后明白了一些原由，不管当初是为啥这样设计反正已经这样了用的时候加小心就成了，代码的意思主要难在第一个<code>if</code> 块了，判断<code>T[]</code> 的长度和当前集合长度谁大，如果传入数组长度小就执行<code>if</code> 里面，<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function">E <span class="title">elementData</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</div><div class="line">  <span class="keyword">return</span> (E) elementData[index];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>​ 返回数组中下标为 <code>index</code> 的元素，这个方法没有对 <code>index</code> 校验，所以 <code>Java</code> 也没把他设置成可外部访问的方法。 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rangeCheck</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</div><div class="line">  <span class="keyword">if</span> (index &gt;= size) &#123;</div><div class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException(outOfBoundsMsg(index));</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">private</span> String <span class="title">outOfBoundsMsg</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="string">"Index: "</span> + index + <span class="string">", Size: "</span> + size;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​ 只是内部公用的用来公共检查<code>index</code> 是否合法会抛出运行时异常 <code>IndexOutOfBoundsException</code>，另一个方法只是返回一个字符串告诉下标和<code>size</code> 的值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> E <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</div><div class="line">  rangeCheck(index);</div><div class="line">  <span class="keyword">return</span> elementData(index);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​   <code>ArrayList</code> 是常用的方法之一，<code>get(int)</code> 其实现很简单，先是校验 <code>index</code> 的合法性，之后调用查找元素的方法把对应元素返回。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> E <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, E element)</span> </span>&#123;</div><div class="line">  rangeCheck(index);</div><div class="line">  E oldValue = elementData(index);</div><div class="line">  elementData[index] = element;</div><div class="line">  <span class="keyword">return</span> oldValue;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​ 该方法也很容易功能就是把指定下标的元素替换为新元素，并返回被替换掉的元素。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</div><div class="line">  ensureCapacityInternal(size + <span class="number">1</span>);  <span class="comment">// Increments modCount!!</span></div><div class="line">  elementData[size++] = e;</div><div class="line">  <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​ 这个方法很简单但功能确是很重要，调用方法确定下当前 <code>elementData</code> 数组中确实还有位置可以放下新的元素，这个方法之前学习过不再多说了，确定完容量后把当前这个赋值给数组然后数组长度加一。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, E element)</span> </span>&#123;</div><div class="line">  rangeCheckForAdd(index);</div><div class="line"></div><div class="line">  ensureCapacityInternal(size + <span class="number">1</span>);  <span class="comment">// Increments modCount!!</span></div><div class="line">  System.arraycopy(elementData, index, elementData, index + <span class="number">1</span>,</div><div class="line">                   size - index);</div><div class="line">  elementData[index] = element;</div><div class="line">  size++;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rangeCheckForAdd</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</div><div class="line">  <span class="keyword">if</span> (index &gt; size || index &lt; <span class="number">0</span>) &#123;</div><div class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException(outOfBoundsMsg(index));</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​ 这是 <code>add</code> 的另一个重载方法</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://avatars0.githubusercontent.com/u/9735870?v=3&u=33ed681a589c432a123bbdc242b25d56a1a0ac7b&s=400"
               alt="Fu Liu" />
          <p class="site-author-name" itemprop="name">Fu Liu</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">12</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/flyliufu" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Fu Liu</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  
    
    <script>
      var cloudTieConfig = {
        url: document.location.href, 
        sourceId: "",
        productKey: "c05ff3bcca6e4d2ab2203d81b037e8e8",
        target: "cloud-tie-wrapper"
      };
    </script>
    <script src="https://img1.ws.126.net/f2e/tie/yun/sdk/loader.js"></script>
  







  
  

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("mnghEybRbMmn0L4nJGOpIz0B-gzGzoHsz", "3gyRmnknuevDYYAekIJXbpoL");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  


  

</body>
</html>
